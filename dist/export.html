<style>
/* .col {
    display: flex;
    flex-direction: row;
    gap: 0.5rem;
} */

:root {
  --spacing: 0.8rem;
}

* {
  box-sizing: border-box;
}

form {
  display: flex;
  flex-direction: column;
  gap: var(--spacing);
  width: 100%;
  margin-bottom: 0px;
}

body {
  background-color: var(--figma-color-bg);
  color: var(--figma-color-text);
  margin: 0;
  padding: var(--spacing);
}

html,
body,
main {
  height: 100%;
}

main {
  display: flex;
  flex-direction: column;
  gap: var(--spacing);
}

textarea {
  background-color: var(--figma-color-bg-secondary);
  border: 2px solid var(--figma-color-border);
  color: var(--figma-color-text-secondary);
  flex: 1;
  font-family: Andale Mono, monospace;
  font-size: 0.9rem;
  overflow: auto;
  padding: var(--spacing);
  white-space: pre;
}
textarea:focus {
  border-color: var(--figma-color-border-selected);
  outline: none;
}

form,
textarea {
  display: block;
  width: 100%;
}

select,
input,
textarea {
  background-color: var(--figma-color-bg-secondary);
  color: var(--figma-color-text-secondary);
  border: 2px solid var(--figma-color-border);
}

input:focus,
textarea:focus {
  border-color: var(--figma-color-border-selected);
  outline: none;
}

select,
input {
  flex: 1;
  margin-bottom: var(--spacing);
}

form .row {
  display: flex;
  gap: 0.5rem;
}

button {
  border: 1px solid rgba(255, 255, 255, 0.1);
  outline: none;
  background-color: transparent;
  color: white;
  font-family: "Roboto", sans-serif;
  font-size: 14px;
  font-weight: 400;
  line-height: 1.5;
  text-align: center;
  padding: 1rem;
  cursor: pointer;
  transition: all 0.3s ease-in-out;
  text-overflow: ellipsis;
  flex-grow: 1;
}

button:hover {
  color: lightgray;
  background-color: rgba(255, 255, 255, 0.1);
}

button:disabled {
  border: 1px solid rgb(113, 113, 113);
  outline: none;
  background-color: rgb(64, 64, 64);
  color: white;
  cursor: not-allowed;
}

button:disabled:hover {
  background-color: rgb(64, 64, 64);
}

.cta-wrapper {
  width: 100%;
  display: flex;
  gap: 1rem;
  flex-direction: row;
  align-items: center;
  justify-content: stretch;
  box-sizing: border-box;
}
	</style>
<style>
textarea::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

textarea::-webkit-scrollbar-track {
  background: transparent;
}

textarea::-webkit-scrollbar-thumb {
  background-color: gray;
  border-radius: 8px;
  border: 2px solid transparent;
}

textarea::-webkit-scrollbar-thumb:hover {
  background-color: lightgray;
  cursor: pointer;
}

textarea::-webkit-scrollbar-thumb:active {
  background-color: lightgray;
}

textarea::-webkit-scrollbar-thumb:vertical {
  border-radius: 8px;
}

textarea::-webkit-scrollbar-thumb:horizontal {
  border-radius: 8px;
}

textarea::-webkit-scrollbar-corner {
  background: transparent;
}

textarea::-webkit-resizer {
  background: transparent;
}

textarea::-webkit-scrollbar-button {
  display: none;
}

textarea::-webkit-scrollbar-button:end:increment {
  display: none;
}
.tablepreview-wrapper::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

.tablepreview-wrapper::-webkit-scrollbar-track {
  background: transparent;
}

.tablepreview-wrapper::-webkit-scrollbar-thumb {
  background-color: gray;
  border-radius: 8px;
  border: 2px solid transparent;
  transition: all 1s ease-in-out;
}

.tablepreview-wrapper::-webkit-scrollbar-thumb:hover {
  background-color: lightgray;
  cursor: pointer;
}

.tablepreview-wrapper::-webkit-scrollbar-thumb:active {
  background-color: lightgray;
}

.tablepreview-wrapper::-webkit-scrollbar-thumb:vertical {
  border-radius: 8px;
}

.tablepreview-wrapper::-webkit-scrollbar-thumb:horizontal {
  border-radius: 8px;
}

.tablepreview-wrapper::-webkit-scrollbar-corner {
  background: transparent;
}

.tablepreview-wrapper::-webkit-resizer {
  background: transparent;
}

.tablepreview-wrapper::-webkit-scrollbar-button {
  display: none;
}

.tablepreview-wrapper::-webkit-scrollbar-button:end:increment {
  display: none;
}

.tablepreview-wrapper {
  flex: 1;
  justify-self: stretch;
  align-self: stretch;
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  justify-content: flex-start;
  text-align: left;
  border-radius: 8px;
  overflow: auto;
  padding: 0px;
  background-color: rgba(0, 0, 0, 0.10);
  border: gray 1px solid;
}

.tablepreview-wrapper table {
  position: absolute;
  top: 0;
  left: 0;
}

.tablepreview-wrapper.hidden {
  display: none;
}

table {
  border-collapse: collapse;
  margin: 0;
  font-size: 0.9em;
  font-family: sans-serif;
  min-width: 100%;
}

table thead tr {
  color: inherit;
  text-align: left;
  background-color: rgba(0, 0, 0, 0.35);
}

table thead {
  background-color: rgb(35, 35, 35);
  position: sticky;
  top: 0;
  outline: 1px solid gray;
}

table th,
table td {
  padding: 12px 15px;
}

table tbody tr {
  border-bottom: 1px solid gray;
}

table tbody tr:nth-of-type(even) {
  background-color: rgba(0, 0, 0, 0.10);
}

table tbody tr:last-of-type {
  border-bottom-style: none;
}

table tbody td.changed {
  background-color: rgba(0, 255, 0, 0.2);
}

#notice {
  pointer-events: none;
  text-align: left;
  padding: 12px;
  transition: all 0.5s ease-in-out;
  border-radius: 8px;
  place-self: stretch;
}

#notice p {
  margin: 0;
  padding: 0;
  font-family: "Roboto", sans-serif;
  font-size: 14px;
  font-weight: 400;
  line-height: 1.5;
  text-align: left;
}

.error-box {
  background-color: #ffe5e5;
  border: #a35f5f 1px solid;
}

.info-box {
  background-color: #e5e5ff;
  border: #5f5fa3 1px solid;
}

#notice.hidden {
  display: none;
}

.error-box p {
  color: #a35f5f;
}

.info-box p {
  color: #5f5fa3;
}	</style>
<style>
.select-box {
    position: relative;
    display: inline-block;
    width: 70%;
    margin: 0 auto;
    font-family: 'Open Sans', 'Helvetica Neue', 'Segoe UI', 'Calibri', 'Arial', sans-serif;
    font-size: 18px;
    color: #60666d;
}
/* @media (min-width: 768px) {
    .select-box {
        width: 70%;
   }
}
@media (min-width: 992px) {
    .select-box {
        width: 50%;
   }
}
@media (min-width: 1200px) {
    .select-box {
        width: 30%;
   }
} */

ul {
    margin-block-start: 4px;
    margin-block-end: 4px;
}

.select-box__current {
    position: relative;
    box-shadow: 0 15px 30px -10px rgba(0, 0, 0, 0.1);
    cursor: pointer;
    outline: none;
}
.select-box__current:focus + .select-box__list {
    opacity: 1;
    animation-name: none;
}
.select-box__current:focus + .select-box__list .select-box__option {
    cursor: pointer;
}
.select-box__current:focus .select-box__icon {
    transform: translateY(-50%) rotate(180deg);
}
.select-box__icon {
    position: absolute;
    top: 50%;
    right: 15px;
    transform: translateY(-50%);
    width: 20px;
    opacity: 0.3;
    transition: 0.2s ease;
}
.select-box__value {
    display: flex;
}
.select-box__input {
    display: none;
}
.select-box__input:checked + .select-box__input-text {
    display: block;
}
.select-box__input-text {
    display: none;
    width: 100%;
    margin: 0;
    padding: 15px;
    background-color: #fff;
}
.select-box__list {
    position: absolute;
    width: 100%;
    padding: 0;
    list-style: none;
    opacity: 0;
    animation-name: HideList;
    animation-duration: 0.5s;
    animation-delay: 0.5s;
    animation-fill-mode: forwards;
    animation-timing-function: step-start;
    box-shadow: 0 15px 30px -10px rgba(0, 0, 0, 0.1);
}
.select-box__option {
    display: block;
    padding: 15px;
    background-color: #fff;
}
.select-box__option:hover, .select-box__option:focus {
    color: #546c84;
    background-color: #fbfbfb;
}
@keyframes HideList {
    from {
        transform: scaleY(1);
   }
    to {
        transform: scaleY(0);
   }
}
	</style>
<main>
  <form>
    <div class="row">
      <div id="collectionSelect" class="select-box">
        <div class="select-box__current" tabindex="1">
          <div class="select-box__value"></div>
          <img
            aria-hidden="true"
            class="select-box__icon"
            alt="Arrow Icon"
            src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gU3ZnIFZlY3RvciBJY29ucyA6IGh0dHA6Ly93d3cub25saW5ld2ViZm9udHMuY29tL2ljb24gLS0+DQo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMjU2IDI1NiIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMjU2IDI1NiIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8bWV0YWRhdGE+IFN2ZyBWZWN0b3IgSWNvbnMgOiBodHRwOi8vd3d3Lm9ubGluZXdlYmZvbnRzLmNvbS9pY29uIDwvbWV0YWRhdGE+DQo8Zz48Zz48cGF0aCBmaWxsPSIjMDAwMDAwIiBkPSJNMTI4LDE5NC4zTDEwLDc2LjhsMTUuNS0xNS4xTDEyOCwxNjQuMkwyMzAuNSw2MS43TDI0Niw3Ni44TDEyOCwxOTQuM3oiLz48L2c+PC9nPg0KPC9zdmc+"
          />
        </div>
        <ul class="select-box__list"></ul>
      </div>
      <button id="CSV" type="button" class="click">Generate CSV</button>
    </div>
    <!-- <div class="row">
      <button id="JSON" type="button" class="click hidden">
        Export Variables to JSON
      </button>
      <button id="" type="button" class="click">
        Export Variables to CSV
      </button>
    </div> -->
  </form>
  <textarea
    placeholder="Exported variables will render here..."
    readonly
  ></textarea>
  <div id="notice" class="error-box">
    <p>
      Lorem ipsum dolor, sit amet consectetur adipisicing elit. Recusandae quam
      earum animi, iste, dolor repudiandae dolore molestiae ut eius facere
      natus. Quae, fugit eligendi! Architecto, blanditiis! Provident iusto
      dolorem debitis.
    </p>
  </div>
  <div class="cta-wrapper">
    <button id="copy" type="button" class="hidden">Copy</button>
  </div>
</main>
<script>
  window.onmessage = ({ data: { pluginMessage } }) => {
    if (pluginMessage.type === "EXPORT_RESULT") {
      const result = pluginMessage.result;
      let printedResult;
      let validResult = false;
      if (
        pluginMessage.fileType === "JSON" &&
        JSON.parse(result).length === 0
      ) {
        printedResult = "No variables to export";
      } else if (pluginMessage.fileType === "CSV") {
        const row = result.split("\n");
        if (row.length <= 1) {
          printedResult = "No variables to export";
        } else {
          printedResult = result;
          validResult = true;
        }
      } else {
        printedResult = result;
        validResult = true;
      }
      document.querySelector("textarea").innerHTML = printedResult;
      if (validResult) {
        document.querySelector("#copy").classList.remove("hidden");
      }
    } else if (pluginMessage.type === "GET_COLLECTIONS") {
      console.log("GET_COLLECTIONS");
      const select = document.querySelector("#collectionSelect");
      pluginMessage.result.forEach((collection) => {
        /* const option = document.createElement("option");
        option.value = collection.id;
        console.log(collection.id);
        option.innerHTML = collection.name;
        console.log(collection.name);
        select.appendChild(option); */
        const index = pluginMessage.result.indexOf(collection);

        // radio button
        const radioTarget = document.querySelector(".select-box__value");
        const radio = document.createElement("input");
        radio.type = "radio";
        radio.classList.add("select-box__input");
        radio.id = collection.id;
        radio.value = collection.id;
        radio.name = "collectionSelect";
        const radioLabel = document.createElement("p");
        radioLabel.classList.add("select-box__input-text");
        radioLabel.innerHTML = collection.name;
        radioTarget.appendChild(radio);
        radioTarget.appendChild(radioLabel);

        if (index === 0) {
          radio.checked = "checked";
        }

        // label in the dropdown list
        const labelTarget = document.querySelector(".select-box__list");
        const labelWrapper = document.createElement("li");
        const label = document.createElement("label");
        label.classList.add("select-box__option");
        label.htmlFor = collection.id;
        label.innerHTML = collection.name;
        labelWrapper.appendChild(label);
        labelTarget.appendChild(labelWrapper);

        console.log(radioTarget.innerHTML);
        console.log(labelTarget.innerHTML);
      });
      // set the value of the first radio button
      document.querySelector(".select-box__input").checked = "checked";
    }
  };
  //
  document.querySelectorAll(".select-box__option").forEach((option) => {
    option.addEventListener("click", () => {
      const select = document.querySelector(
        "#collectionSelect .select-box__input[name='collectionSelect']"
      );
      select.value = option.htmlFor;
      // log the currently selected radio input value
      console.log("Now selected:");
      console.log(
        document.querySelector(
          "#collectionSelect .select-box__input[name='collectionSelect']:checked"
        ).value
      );
    });
  });
  //
  document.querySelector("#copy").onclick = function () {
    document.querySelector("textarea").select();
    document.execCommand("copy");
    // alert("Copied to clipboard");
  };
  //
  const clickable = document.querySelectorAll(".click");
  function postExportMessage(e) {
    parent.postMessage(
      {
        pluginMessage: {
          type: "EXPORT",
          submitter: e.target.id,
          collectionId: document.querySelector(
            "#collectionSelect .select-box__input[name='collectionSelect']:checked"
          ).value,
        },
      },
      "*"
    );
  }
  Array.from(clickable).forEach(function (button) {
    button.addEventListener("click", postExportMessage);
  });
</script>
